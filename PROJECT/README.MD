# Веб-кластер Active/Active Pacemaker Corosync с балансировкой на IPaddr2, Galera Cluster и iSCSI GFS2. 

![Схема проекта](//https://github.com/romanbondarenko1992/Otus/blob/master/PROJECT/scheme.jpg)

Cконфигурировал 4 виртуальные машины на 2 интерфейса:
1) для создания VirtualIP и подключению
2) для создания Vlan для соединения с iSCSI-storage.

- 139 iSCSI.brs 10.51.21.71
- 140 n1.brs 10.51.21.74
- 141 n2.brs 10.51.21.72
- 142 n3.brs 10.51.21.73

Балансировку и виртуальный адрес мы создаем ремурсами Pacemaker - IPaddr2 c параметром clusterip_hash="sourceip-sourceport"

clusterip_hash -указывает нужный тип для распределения запросов:
- sourceip — распределение только по IP-адресу источника, это обеспечивает попадание запросов на один и тот же сервер.
- sourceip-sourceport — распределение по исходящему порту и IP источника. При новом подключении будет производится соединение с новым сервером. Подходящий вариант.
- sourceip-sourceport-destport — распределение по порту получателя, порту источника и IP-адресу. Получаем наилучшее распределение, если несколько сервисов работают на разных портах.

В качестве веб-сервера используем NGINX, хранилищем для веб-приложения Wordpress выступает iSCSI-storage с GFS2. Для кластеризации MySQL использовали Galera cluster в режиме master/master.

STONITH реализован на fence-agents для Proxmox.

Все переменные для плейбука указаны в gpoup_vars/. После работы плейбука должен подняться готовый веб-кластер по адресу 10.51.21.75/wordpress для начальной конфигурации. 
